# 知识库管理系统完整启动指南

## 🚀 系统架构

本系统包含以下组件：
1. **Java Spring Boot应用** - 主后端服务
2. **Python服务** - 文档处理和AI功能
3. **Elasticsearch** - 知识检索引擎
4. **MySQL数据库** - 数据存储

## 📋 启动顺序

### 第一步：启动Elasticsearch

```bash
# 方法1：使用批处理脚本
start_elasticsearch.bat

# 方法2：手动启动
cd D:\xmc\elasticsearch-9.1.0-windows-x86_64\elasticsearch-9.1.0
.\bin\elasticsearch.bat
```

**等待时间**: 30-60秒（首次启动较慢）

**验证启动**:
```bash
# 测试连接
python test_es_status.py

# 或直接访问
http://localhost:9200
```

### 第二步：设置Elasticsearch知识库

```bash
# 安装Python依赖
pip install elasticsearch requests

# 运行设置脚本
python es_setup.py
```

### 第三步：启动Java应用

```bash
# 方法1：使用PowerShell脚本
.\start_app.ps1

# 方法2：手动启动
mvn clean compile
mvn spring-boot:run
```

### 第四步：启动Python服务（可选）

```bash
# 启动Python文档处理服务
cd python_service
python app_pymupdf_pro.py
```

## 🔧 各组件配置

### 1. Elasticsearch配置

**端口**: 9200
**访问地址**: http://localhost:9200
**管理界面**: http://localhost:9200/_cat/indices?v

**知识库索引**: `knowledge_base`
- 支持中文分词
- 多字段搜索
- 高亮显示

### 2. Java应用配置

**端口**: 8080
**访问地址**: http://localhost:8080
**API文档**: http://localhost:8080/swagger-ui.html

**数据库**: MySQL (localhost:3306)
**数据库名**: knowledge_base

### 3. Python服务配置

**端口**: 8000
**访问地址**: http://localhost:8000
**功能**: 文档处理、AI对话

## 📊 验证各组件状态

### 1. 检查Elasticsearch
```bash
python test_es_status.py
```

### 2. 检查Java应用
```bash
python test_app_status.py
```

### 3. 检查Python服务
```bash
curl http://localhost:8000/health
```

## 🌐 访问地址汇总

| 组件 | 地址 | 说明 |
|------|------|------|
| Elasticsearch | http://localhost:9200 | ES主服务 |
| ES集群健康 | http://localhost:9200/_cluster/health | 集群状态 |
| ES索引管理 | http://localhost:9200/_cat/indices?v | 索引列表 |
| Java应用 | http://localhost:8080 | 主应用 |
| API文档 | http://localhost:8080/swagger-ui.html | Swagger UI |
| Python服务 | http://localhost:8000 | 文档处理 |

## 🔍 知识检索使用

### 1. 通过API搜索
```bash
# 搜索知识
curl -X POST "localhost:8080/api/search" \
  -H "Content-Type: application/json" \
  -d '{"query": "Spring Boot", "page": 1, "size": 10}'
```

### 2. 直接访问ES
```bash
# 搜索文档
curl -X POST "localhost:9200/knowledge_base/_search" \
  -H "Content-Type: application/json" \
  -d '{
    "query": {
      "multi_match": {
        "query": "搜索关键词",
        "fields": ["title^2", "content", "chunk_content"]
      }
    }
  }'
```

### 3. 添加知识文档
```bash
# 添加单个文档
curl -X POST "localhost:9200/knowledge_base/_doc" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "文档标题",
    "content": "文档内容",
    "category": "技术文档",
    "author": "作者"
  }'
```

## 🐛 常见问题解决

### 1. Elasticsearch启动失败

**问题**: 端口被占用
```bash
# 检查端口占用
netstat -ano | findstr :9200

# 杀死占用进程
taskkill /PID <进程ID> /F
```

**问题**: 内存不足
```bash
# 编辑配置文件
# D:\xmc\elasticsearch-9.1.0-windows-x86_64\elasticsearch-9.1.0\config\jvm.options
# 设置: -Xms1g -Xmx1g
```

### 2. Java应用启动失败

**问题**: 数据库连接失败
```bash
# 检查MySQL服务
net start mysql

# 检查数据库是否存在
mysql -u root -p
CREATE DATABASE IF NOT EXISTS knowledge_base;
```

**问题**: 端口被占用
```bash
# 检查端口占用
netstat -ano | findstr :8080

# 杀死占用进程
taskkill /PID <进程ID> /F
```

### 3. Python服务启动失败

**问题**: 依赖缺失
```bash
# 安装依赖
pip install -r python_service/requirements.txt
```

**问题**: PyMuPDF Pro字体问题
```bash
# 运行字体修复脚本
python python_service/pymupdf_font_fix.py
```

## 📈 性能优化建议

### 1. Elasticsearch优化
- 设置合适的内存大小
- 定期清理无用索引
- 使用批量操作提高效率

### 2. Java应用优化
- 调整JVM参数
- 使用连接池
- 启用缓存

### 3. 系统整体优化
- 监控各组件状态
- 定期备份数据
- 日志轮转

## 🔄 重启流程

### 完整重启
```bash
# 1. 停止所有服务
# 2. 启动Elasticsearch
start_elasticsearch.bat

# 3. 等待ES启动完成（30-60秒）
python test_es_status.py

# 4. 设置知识库
python es_setup.py

# 5. 启动Java应用
.\start_app.ps1

# 6. 启动Python服务（可选）
cd python_service
python app_pymupdf_pro.py
```

### 快速重启
```bash
# 仅重启Java应用
mvn spring-boot:run
```

## 📞 技术支持

### 日志查看
- **Java应用**: 查看控制台输出
- **Elasticsearch**: `logs/elasticsearch.log`
- **Python服务**: 查看控制台输出

### 调试工具
- **ES状态检查**: `python test_es_status.py`
- **应用状态检查**: `python test_app_status.py`
- **API测试**: 使用Swagger UI

### 联系方式
- 查看项目文档
- 检查日志文件
- 运行诊断脚本 